{{ 'shop-by-size.css' | asset_url | stylesheet_tag }}
<script src="{{ 'shop-by-size.js' | asset_url }}" defer="defer"></script>

<style>
  #shopify-section-{{ section.id }} {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.bg_color }};
  }

  @media only screen and (max-width: 990px) {
    #shopify-section-{{ section.id }} {
      padding-top: {{ section.settings.mobile_padding_top }}px;
      padding-bottom: {{ section.settings.mobile_padding_bottom }}px;
    }
  }
</style>

{%- capture css_variables -%}
  --title-fz: {{ section.settings.title_font_size }}px;
  --title-fz-mb: {{ section.settings.title_font_size_mb }}px;
  --title-color: {{ section.settings.title_color }};
  --content-mb: {{ section.settings.content_margin_bottom }}px;
  --content-mb-mb: {{ section.settings.content_margin_bottom_mb }}px; 
{%- endcapture -%}

<div class="page-width" style="{{- css_variables | strip_newlines -}}">
   {%- if section.settings.title != blank -%}
    <div class="shop-by-size__header {% if section.settings.button_label != blank %}shop-by-size__header--with-button{% endif %}">
      <h2 class="shop-by-size__title">
        {{ section.settings.title }}
      </h2>

      {%- if section.settings.button_label != blank -%}
        <a href="{{ section.settings.button_link }}" class="button shop-by-size__header-link">
          {{ section.settings.button_label | escape }}
        </a>
      {%- endif -%}
    </div>
   {%- endif -%}

  <shop-by-size class="shop-by-size__section">
    <div class="shop-by-size__navigation {% if section.settings.centered_tab %}shop-by-size__navigation--centered{% endif %}">
      <ul>
        {% assign tab_index = 0 %}
        {%- for block in section.blocks -%}
          {% assign tab_index = tab_index | plus:1 %}
          <li>
              <a href="/" 
                class="shop-by-size__tab {% if tab_index == 1 %}shop-by-size__tab--active {% endif %}" 
                data-id="tab{{ tab_index }}">
                {{ block.settings.title }}
              </a>
            </li>
          {% endfor %}
      </ul>
    </div>

    {% assign index = 0 %}
    {%- for block in section.blocks -%}
      {% assign index = index | plus:1 %}
      <div class="shop-by-size__products {% if index == 1 %}shop-by-size__products--active {% endif %}" data-id="tab{{index}}">
        <div class="shop-by-size__swiper js-shop-by-size-swiper">
          <div class="swiper-wrapper">
            {% for product in block.settings.products limit: 20 %}
              {% for collection in product.collections %}
                {% if collection.title contains ' |' %}
                  {% assign grouped_collection = collection %}
                {% endif %}
              {% endfor %}
              <div class="shop-by-size__item swiper-slide">
                  <div class="shop-by-size__product-card">
                    {% render 'product-card-custom',
                      product_card_product: product,
                      collection: grouped_collection,
                      title: grouped_collection.title,
                      custom_image: product.metafields.custom.image_for_homepage,
                      show_product_badge: section.settings.show_product_badge
                    %}
                  </div>
              </div>
            {% endfor %}
          </div>
          <div class="swiper-button-prev swiper-button-prev{{index}}"> 
            {% render 'icon' with 'small-arrow' %} 
          </div>
          <div class="swiper-button-next swiper-button-next{{index}}">
            {% render 'icon' with 'small-arrow' %} 
          </div>
          <div class="swiper-pagination"></div>
        </div>
       
      {%- if block.settings.link_text != blank -%}
      <div class="shop-by-size__link">
        <a href="{{ block.settings.link_url }}" class="shop-by-size__link-link">
          {{ block.settings.link_text | escape }}
        </a>
      </div>
      {%- endif -%}
       </div>
    {%  endfor %}
  </shop-by-size>

  {% comment %}
  {%- if section.settings.link_text != blank -%}
   <div class="shop-by-size__link">
       <a href="{{ section.settings.link_url }}" class="shop-by-size__link-link">
         {{ section.settings.link_text | escape }}
       </a>
     </div>
  {%- endif -%} {% endcomment %}
</div>


{% schema %}
  {
    "name": "Shop by size",
    "class": "shop-by-size",
    "tag": "section",
    "settings": [
      {
        "type": "header",
        "content": "Layout"
      },
      {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 120,
        "step": 2,
        "unit": "px",
        "label": "Padding Top",
        "default": 60
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 120,
        "step": 2,
        "unit": "px",
        "label": "Padding Bottom",
        "default": 60
      },
      {
        "type": "range",
        "id": "mobile_padding_top",
        "min": 0,
        "max": 120,
        "step": 2,
        "unit": "px",
        "label": "Mobile Padding Top",
        "default": 30
      },
      {
        "type": "range",
        "id": "mobile_padding_bottom",
        "min": 0,
        "max": 120,
        "step": 2,
        "unit": "px",
        "label": "Mobile Padding Bottom",
        "default": 30
      },
      {
        "type": "color",
        "id": "bg_color",
        "label": "Background color",
        "default": "#ffffff"
      },
      {
        "type": "header",
        "content": "Heading"
      },
      {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "Add Title..."
      },
      {
        "type": "range",
        "id": "title_font_size",
        "min": 10,
        "max": 100,
        "step": 1,
        "unit": "px",
        "label": "Title Font Size",
        "default": 42
      },
      {
        "type": "range",
        "id": "title_font_size_mb",
        "min": 10,
        "max": 70,
        "step": 1,
        "unit": "px",
        "label": "Title Font Size (Mobile)",
        "default": 24
      },
      {
        "type": "color",
        "id": "title_color",
        "label": "Title Color",
        "default": "#546B82"
      },
      {
        "type": "text",
        "id": "button_label",
        "label": "Button Label"
      },
      {
        "type": "url",
        "id": "button_link",
        "label": "Button Link"
      },
      {
        "type": "range",
        "id": "content_margin_bottom",
        "min": 0,
        "max": 120,
        "step": 2,
        "unit": "px",
        "label": "Content Margin Bottom",
        "default": 30
      },
      {
        "type": "range",
        "id": "content_margin_bottom_mb",
        "min": 0,
        "max": 120,
        "step": 2,
        "unit": "px",
        "label": "Content Margin Bottom (Mobile)",
        "default": 20
      },
      {
        "type": "header",
        "content": "Product settings"
      },
      {
        "type": "checkbox",
        "id": "centered_tab",
        "label": "Center tabs",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_product_badge",
        "label": "Show product badge",
        "default": true
      },
    
      ],
      "blocks": [
      {
       "type": "block",
       "name": "Size",
       "limit": 5,
       "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Tab Title",
            "default": "Tab title"
          },
          {
            "type": "product_list",
            "id": "products",
            "label": "Products",
          },
          {
            "type": "text",
            "id": "link_text",
            "label": "Link text"
          },
          {
            "type": "url",
            "id": "link_url",
            "label": "Link URL"
          }
        ]
      }
    ],  
    "presets": [
      {
        "name": "Shop by size",
        "settings": {
        }
      }
    ]
  }
{% endschema %}