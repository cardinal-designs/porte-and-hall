{{ 'component-product-card.css' | asset_url | stylesheet_tag }}
{{ 'shop-story.css' | asset_url | stylesheet_tag }}

<div class="Shop_Story_Carousel">
  <div class="page-width">
    <div class="text-center">
      <div class="h2 blue">{{ section.settings.heading }}</div>
    </div>
  </div>
  <shop-story-carousel>
    <div class="shop-story-carousel__container swiper" id="{{ section.id }}-shop-story-container">
      <div class="swiper-pagination shop-story-carousel__pagination"></div>
      <div class="shop-story-carousel__item  swiper-wrapper">
        {% assign my_fields = article.metafields.custom %}
        {% for product in my_fields.shop_story_product.value limit: 5 %}
          {% for collection in product.collections %}
            {% if collection.title contains ' | ' %}
              {% assign grouped_collection = collection %}
            {% endif %}
          {% endfor %}
          {% if rendered_collections contains grouped_collection.title %}
            {% continue %}
          {% else %}
            {% assign rendered_collections = rendered_collections
              | append: grouped_collection.title
              | append: ', '
            %}
          {% endif %}
          <div class="swiper-slide">
            {% render 'article-product-card',
              product_card_product: product,
              title: grouped_collection.title,
              collection: grouped_collection,
              button_text: 'Shop Now',
              my_fields:my_fields
            %}
          </div>
        {{ collection }}
        {% endfor %}
      </div>
    </div>
  </shop-story-carousel>
</div>

{% schema %}
  {
    "name": "Shop the Story",
    "tag": "section",
    "class": "with-spacing",
    "settings": [
      {
        "type": "richtext",
        "id": "heading",
        "label": "Heading"
      },
      {
        "type": "checkbox",
        "id": "show_color_swatch",
        "label": "Show color swatch",
        "info": "Some colors appear white? [Learn more](http://support.maestrooo.com/article/80-product-uploading-custom-color-for-color-swatch).",
        "default": true
      }
    ],
    "presets": [
      {
        "name": "Shop the Story"
      }
    ]
  }
{% endschema %}