{% doc %}
  Renders gift card recipient form.
  Accepts:

  @param {product} product - The product object.
  @param {form} form - The product form object.
  @param {section} section - The section to which this snippet belongs.

  @example
  {% render 'gift-card-recipient-form', product: product, form: form, section: section %}
{% enddoc %}

<script src="{{ 'recipient-form.js' | asset_url }}" defer="defer"></script>
{{- 'recipient-form.css' | asset_url | stylesheet_tag -}}

{%- assign gift_card_recipient_control_flag = 'properties[__shopify_send_gift_card_to_recipient]' -%}

<recipient-form
  show-scroll
  class="recipient-form form"
  data-section-id="{{ section.id }}"
  data-product-variant-id="{{ product.selected_or_first_available_variant.id }}"
>
  <div class="recipient-form__fake-checkbox form__fakeCheckbox">
    <input
      id="Recipient-checkbox-{{ section.id }}"
      type="checkbox"
      name="{{ gift_card_recipient_control_flag }}"
    >
    <label class="recipient-checkbox" for="Recipient-checkbox-{{ section.id }}">
      <span class="fakeCheckbox__icon">
        {% render 'icon', icon: 'checkmark' %}
      </span>
      <span>{{ 'recipient.form.checkbox' | t }}</span>
    </label>
  </div>
  
  <div
    class="product-form__recipient-error-message-wrapper hidden"
    role="alert"
  >
    <h2 class="form__message" tabindex="-1" autofocus>
      <span class="error-message">{{ 'templates.contact.form.error_heading' | t }}</span>
    </h2>

    <ul>
      {%- if form.errors -%}
        {%- for field in form.errors -%}
          <li>
            {%- if field == 'form' -%}
              {{ form.errors.messages[field] }}
            {%- else -%}
              <a href="#Recipient-{{ field }}-{{ section.id }}">
                {{ form.errors.messages[field] }}
              </a>
            {%- endif -%}
          </li>
        {%- endfor -%}
      {%- endif -%}
    </ul>
  </div>

  <p
    id="Recipient-fields-live-region-{{ section.id }}"
    class="visually-hidden"
    role="status"
  ></p>
  <div class="recipient-fields">
    <hr>
    <div class="recipient-fields__field recipient-fields__field--email">
      <div class="field">
        <label class="field__label" for="Recipient-email-{{ section.id }}">
          <span class="recipient-email-label required">{{ 'recipient.form.email_label' | t }}</span>
          <span class="recipient-email-label optional">
            {{- 'recipient.form.email_label_optional_for_no_js_behavior' | t -}}
          </span>
        </label>
        <input
          class="field__input input"
          id="Recipient-email-{{ section.id }}"
          type="email"
          placeholder="{{ 'recipient.form.email_label' | t }}"
          name="properties[Recipient email]"
          value="{{ form.email }}"
          {% if form.errors contains 'email' %}
            aria-invalid="true"
            aria-describedby="RecipientForm-email-error-{{ section.id }}"
          {% endif %}
        >
      </div>
      <div
          id="RecipientForm-email-error-{{ section.id }}"
          class="form__message{% unless form.errors contains 'email' %} hidden{% endunless %}"
        >
          <span class="error-message">
            {%- if form.errors contains 'email' -%}
              {{ form.errors.messages.email }}.
            {%- endif -%}
          </span>
        </div>
    </div>

    <div class="recipient-fields__field">
      <div class="field">
        <label class="field__label" for="Recipient-name-{{ section.id }}">
          {{- 'recipient.form.name_label' | t -}}
        </label>
        <input
          class="field__input input"
          autocomplete="name"
          type="text"
          id="Recipient-name-{{ section.id }}"
          name="properties[Recipient name]"
          placeholder="{{ 'recipient.form.name_label' | t }}"
          value="{{ form.name }}"
        >
      </div>
    </div>

    <div class="recipient-fields__field recipient-fields__field--send-on">
      <div class="field">
        <label class="form__label field__label" for="Recipient-send-on-{{ section.id }}">
          {{ 'recipient.form.send_on_label' | t }}
        </label>
        <input
          class="field__input input text-body"
          autocomplete="send_on"
          type="date"
          id="Recipient-send-on-{{ section.id }}"
          name="properties[Send on]"
          placeholder="{{ 'recipient.form.send_on_label' | t }}"
          pattern="\d{4}-\d{2}-\d{2}"
          value="{{ form.send_on }}"
           min="{{ 'now' | date: '%Y-%m-%d' }}"
        >
      </div>

      <div
          class="recipient-hint form__message"
          id="Recipient-send-on-hint-{{ section.id }}"
        >
          {{ 'recipient.form.date_hint' | t }}
        </div>
    </div>

    <div class="recipient-fields__field recipient-fields__field--message">
      {%- assign max_chars_message = 200 -%}
      {%- assign max_chars_message_rendered = 'recipient.form.max_characters' | t: max_chars: max_chars_message -%}
      {%- assign message_label_rendered = 'recipient.form.message_label' | t -%}
      <div class="field">
        <label class="form__label field__label" for="Recipient-message-{{ section.id }}">
          {{ message_label_rendered }}
        </label>
        <textarea
          rows="10"
          id="Recipient-message-{{ section.id }}"
          class="text-area field__input input"
          name="properties[Message]"
          maxlength="{{ max_chars_message }}"
          placeholder="{{ message_label_rendered}}"
          aria-label="{{ message_label_rendered }} {{ max_chars_message_rendered }}"
        >{{ form.message }}</textarea>
      </div>

      <label class="form__label recipient-form-field-label recipient-form-field-label--space-between">
        <span>{{ max_chars_message_rendered }}</span>
      </label>
    </div>
  </div>
  <input
    type="hidden"
    name="{{ gift_card_recipient_control_flag }}"
    value="if_present"
    id="Recipient-control-{{ section.id }}"
  >
  <input
    type="hidden"
    name="properties[__shopify_offset]"
    value=""
    id="Recipient-timezone-offset-{{ section.id }}"
    disabled
  >
</recipient-form>
